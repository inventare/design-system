import{C as c}from"./ComponentManager-CW-XTlUv.js";import{I as l}from"./InitializerTriggerComponent-DjtXnMDk.js";class h{get isFocused(){return this.element===document.activeElement}get isActive(){return this.element.classList.contains("active")}get value(){return this.element.getAttribute("data-value")}constructor(e,t,i){this.select=e,this.element=t,this.previous=i,this.previous&&(this.previous.next=this),this.next=null}blur(){this.isFocused&&this.element.blur()}focus(){this.isFocused||(this.element.focus(),this.element.scrollIntoView({behavior:"instant"}))}focusNext(){var e;(e=this.next)==null||e.focus()}focusPrevious(){var e;(e=this.previous)==null||e.focus()}}class u{constructor(e){this.activeItem=null,this.loadMoreDebounce=null;const{element:t,selectCombobox:i,selectDropDown:s,selectDropDownInner:o}=e;this.element=t,this.comboBoxKeyUp=this.comboBoxKeyUp.bind(this),this.comboBoxClick=this.comboBoxClick.bind(this),this.documentClick=this.documentClick.bind(this),this.dropDownKeyUp=this.dropDownKeyUp.bind(this),this.dropDownClick=this.dropDownClick.bind(this),this.dropDownScroll=this.dropDownScroll.bind(this),this.selectCombobox=i,this.selectCombobox.addEventListener("keyup",this.comboBoxKeyUp),this.selectCombobox.addEventListener("click",this.comboBoxClick),this.selectDropDown=s,this.selectDropDownInner=o,this.selectDropDown.addEventListener("keyup",this.dropDownKeyUp),this.selectDropDown.addEventListener("click",this.dropDownClick),this.selectDropDownInner.addEventListener("scroll",this.dropDownScroll),this.activeItem=this.items.find(r=>r.isActive)||null}get isExpanded(){return this.element.classList.contains("expanded")}get items(){const e=[...this.element.querySelectorAll("button.select-item")],t=[];for(const i of e)t.push(new h(this,i,t.length>0?t[t.length-1]:null));return t}getItemByElement(e){return this.items.find(t=>t.element===e)||null}comboBoxClick(){if(this.isExpanded)return this.hide();this.show()}comboBoxKeyUp(e){e.key==="ArrowDown"&&(this.isExpanded||this.show(),this.onArrowDown()),e.key==="ArrowUp"&&(this.isExpanded||this.show(),this.onArrowUp())}onArrowDown(){const e=this.items;if(!this.activeItem&&e.length)return this.activeItem=e[0],this.activeItem.focus();if(this.activeItem&&this.activeItem.next){const t=this.activeItem.next;this.activeItem.blur(),this.activeItem.focusNext(),this.activeItem=t}}onArrowUp(){var e;if(this.activeItem&&this.activeItem.previous){const t=this.activeItem.previous;this.activeItem.blur(),this.activeItem.focusPrevious(),this.activeItem=t}else this.activeItem&&(this.activeItem.blur(),this.activeItem=null,(e=this.selectDropDown.querySelector("input[type=text]"))==null||e.focus())}dropDownScroll(e){const t=this.selectDropDownInner.scrollHeight,i=this.selectDropDownInner.clientHeight,s=this.selectDropDownInner.scrollTop;this.loadMoreDebounce&&clearTimeout(this.loadMoreDebounce),i+s+10>=t&&(this.loadMoreDebounce=setTimeout(()=>{const o=new CustomEvent("load-more",{bubbles:!0,cancelable:!0,composed:!0});this.element.dispatchEvent(o)},300))}dropDownKeyUp(e){e.key==="ArrowDown"&&this.onArrowDown(),e.key==="ArrowUp"&&this.onArrowUp()}dropDownClick(e){const i=e.target.closest(".select-item");if(!i)return this.hide();const s=this.getItemByElement(i);s&&this.applyValue(s),this.hide()}documentClick(e){e.target.closest(".select-container")!==this.element&&this.hide()}show(){var e,t,i;this.element.classList.add("expanded"),document.addEventListener("click",this.documentClick),(e=this.selectDropDown.querySelector("input[type=text]"))==null||e.focus(),(t=this.selectDropDown.querySelector(".select-dropdown-inner"))==null||t.scrollTo({top:0}),this.activeItem=this.items.find(s=>s.isActive)||null,(i=this.activeItem)==null||i.element.scrollIntoView({behavior:"instant"})}hide(){this.element.classList.remove("expanded"),document.removeEventListener("click",this.documentClick)}applyValue(e){if(!e.value)return;this.activeItem=e,this.items.forEach(s=>s.element.classList.remove("active")),e.element.classList.add("active");const t=this.element.querySelector("input.default-control");if(!t)return;t.value=e.value;const i=this.element.querySelector(".select-value");i&&(i.innerHTML=e.element.innerHTML)}}class a extends c{createInstance(e){return new u(e)}getElement(e){if(!e)return null;const t=e.closest(".select-container");if(!t)return null;const i=t.querySelector(".select");if(!i)return null;const s=t.querySelector(".select-dropdown");if(!s)return null;const o=s.querySelector(".select-dropdown-inner");return o?{id:t.id,element:t,selectCombobox:i,selectDropDown:s,selectDropDownInner:o}:null}initializeInstanceList(e){if(!e){this.initializeInstanceList(document.body);return}const t=[...e.querySelectorAll(".select-container")];for(const i of t)this.getInstance(i)}}l.register(new a);export{a as S};
